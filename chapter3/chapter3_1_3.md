# 3.1.3 트랜잭션

갱신하는 모든 쿼리는 트랜잭션 단위로 실행됩니다. 그래서 갱신 쿼리는 전체 성공하거나, 전체 실패하게 됩니다.

Cypher는 새로운 트랜잭션을 생성하거나 기존에 포함하여 실행합니다.

* Cypher에 실행중인 Context에 트랜잭션이 없는 경우 새로운 트랜잭션을 생성하고 쿼리가 종료되면 커밋을 합니다.
* 실행중인 Context에 트랜잭션이 있는 경우 쿼리는 해당 트랜잭션에서 실행이 되며, 트랜잭션이 성공적으로 커밋할 때 까지 디스크에 반영작업을 하지 않습니다.

다수의 쿼리를 하나의 트랜잭션으로 묶어 커밋할 수 있습니다.

1. 트랜잭션을 연다.
2. 다수의 갱신 쿼리를 수행한다.
3. 완료되면 트랜잭션을 커밋한다.

쿼리는 모든 쿼리가 실행이 완료될 때 까지 변경된 결과를 메모리에 가지고 있음을 유의하시기 바랍니다. 큰 규모의 쿼리는 결과적으로 JVM의 다량의 Heap 영역을 필요로 합니다.

REST API를 이용하여 트랜잭션을 사용할 경우에는 [5.1 트랜잭션 Cypher HTTP 종점](/chapter5/chapter5_1.md)을 참고하시기 바랍니다.

서버 확장을 작성하거나 Neo4j 내장기능을 사용할 때, 실행 결과로부터 오는 반복자는 반드시 모두 사용하거나 그것에 종속된 자원이 정확하게 해제될 수 있도록 닫아야 합니다. 자원들은 쿼리에 의하여 시작된 트랜잭션들을 포함하며 그것이 실패할 경우에는 데드락이나 이상한 동작과 같은 것이 발생하게 됩니다.

